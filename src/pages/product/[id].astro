---
import { Image } from "astro:assets";
import Layout from "../../layouts/layout.astro";
import { getProductBy, getLatestProducts } from "../../services/fakeStore";
import ProductPage from "../../components/ProductPage";

const { id } = Astro.params;

let product: any = null;
if (id) {
    product = await getProductBy({ id });
}

export async function getStaticPaths() {
    const products = await getLatestProducts();

    return products.map((product) => ({
        params: {
            id: product.id,
        },
    }));
}
---

<Layout title={`Product ${product.title}`}>
    <ProductPage client:load image={product.image} title={product.title} description={product.description} />
</Layout>

<script>
    document.addEventListener(
        "astro:page-load",
        () => {
            function zoom(e: any) {
                var zoomer = e.currentTarget;
                let offsetX, offsetY, x, y;
                e.offsetX ? (offsetX = e.offsetX) : (offsetX = e.touches[0]?.pageX);
                e.offsetY ? (offsetY = e.offsetY) : (offsetX = e.touches[0]?.pageX);
                x = (offsetX / zoomer.offsetWidth) * 100;
                y = (offsetY / zoomer.offsetHeight) * 100;
                zoomer.style.backgroundPosition = x + "% " + y + "%";
            }
            document.querySelector(".zoom")?.addEventListener("mousemove", (e) => {
                zoom(e);
            });
        },
        { once: false }
    );
</script>
<style>
    article {
        display: flex;
        flex-direction: column;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
    }

    p {
        text-align: center;
    }

    figure.zoom {
        background-position: 50% 50%;
        position: relative;
        overflow: hidden;
        cursor: crosshair;
    }
    figure.zoom img:hover {
        opacity: 0;
    }
    figure.zoom img {
        transition: opacity 0.5s;
        display: block;
    }
</style>
